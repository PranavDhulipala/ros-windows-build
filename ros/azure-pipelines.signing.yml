resources:
  pipelines:
  - pipeline: ms-iot.humble.release
    source: ms-iot.humble.release
    version: '220831.0006'

jobs:
- job: Signing
  pool: Edge-Robotics-VS2022-ESBuild
  variables:
    ROS_DISTRO: 'humble'
  timeoutInMinutes: 360
  workspace:
    clean: all
  steps:
  - download: ms-iot.humble.release
    artifact: humble-setup

  - task: EsrpCodeSigning@1
    inputs:
      ConnectedServiceName: 'ESRP Signing'
      FolderPath: $(PIPELINE.WORKSPACE)\ms-iot.humble.release\
      Pattern: '*.exe'
      signConfigType: 'inlineSignParams'
      SessionTimeout: '360'
      MaxConcurrency: '50'
      MaxRetryAttempts: '5'
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: '$(PIPELINE.WORKSPACE)\ms-iot.humble.release'
      artifactName: 'ros-$(ROS_DISTRO)-setup-signed'
